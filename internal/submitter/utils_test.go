package submitter

import (
	"math/big"
	"reflect"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
)

func TestDecodeBatchRewardInput(t *testing.T) {
	hexstr := `0x11c7d14400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000d0b814096cb9ca5e140a7616a2885c5abfb71bc100000000000000000000000087fb79e80599392b0069b9b472e53fd32d53a9fd000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000000000c8`
	input, err := hexutil.Decode(hexstr)
	if err != nil {
		t.Error(err)
		return
	}

	expected := &TxInput{
		BatchId:    big.NewInt(2),
		StartEpoch: big.NewInt(1),
		EndEpoch:   big.NewInt(2),
		Seqs: []common.Address{
			common.HexToAddress("0xd0b814096cb9ca5e140a7616a2885c5abfb71bc1"),
			common.HexToAddress("0x87fb79e80599392b0069b9b472e53fd32d53a9fd"),
		},
		Blocks: []*big.Int{big.NewInt(1000), big.NewInt(200)},
	}

	got, err := DecodeBatchRewardInput(input)
	if err != nil {
		t.Error(err)
		return
	}

	if !reflect.DeepEqual(expected, got) {
		t.Errorf("DecodeBatchRewardInput() = %+v, want %+v", got, expected)
	}
}
